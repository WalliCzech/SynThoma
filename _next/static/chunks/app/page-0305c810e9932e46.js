(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{5934:function(t,e,r){Promise.resolve().then(r.bind(r,343))},343:function(t,e,r){"use strict";r.r(e),r.d(e,{default:function(){return T}});var n=r(1514),i=r(7993),a=r(4646),l=r(3069);let o="normal";function c(t){let e=t=>{let e=Array.from(t.querySelectorAll("p.choice"));if(!e.length)return;let r=0;for(;r<e.length;){var n;let i=e[r];if(!i.isConnected){r++;continue}let a=[i],l=r+1;for(;l<e.length&&e[l].previousElementSibling===a[a.length-1];)a.push(e[l]),l++;r=l;let o=document.createElement("div");o.className="choice-box";let c=a[a.length-1].nextElementSibling;for(;c&&c.matches("p.choice");)c=c.nextElementSibling;let s="";if(c&&(c.id||(c.id="auto-block-".concat(Math.random().toString(36).slice(2,8))),s=c.id),s&&c){let e=(c.innerText||"").trim().slice(0,64),r=c.tagName,n=Array.from((t.closest("#reader-content")||document).querySelectorAll(".rich-hidden"));for(let t=n.length-1;t>=0;t--){let i=Array.from(n[t].children).find(t=>t.tagName===r&&(t.innerText||"").trim().startsWith(e));if(i&&!i.id){i.id=s;break}}}for(let t of a){let e=document.createElement("a");e.className="choice-link",e.href="#",e.setAttribute("aria-disabled","false");let r=t.getAttribute("data-next");r?e.setAttribute("data-next",r):s&&e.setAttribute("data-next",s),e.innerHTML=t.innerHTML,o.appendChild(e)}for(let t of(null===(n=a[0].parentElement)||void 0===n||n.insertBefore(o,a[0]),a))t.remove()}};for(let r of(e(t),Array.from(t.querySelectorAll(".rich-hidden"))))e(r)}o=function(){try{let t=localStorage.getItem("typewriterSpeed");if(t&&["instant","fast","normal","slow"].includes(t))return t}catch(t){console.warn("\uD83D\uDCA5 Could not load typewriter speed from localStorage:",t)}return"normal"}();let s="requestIdleCallback"in window?window.requestIdleCallback.bind(window):t=>window.setTimeout(()=>t({timeRemaining:()=>50,didTimeout:!1}),200);function d(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];try{let t="undefined"!=typeof localStorage?localStorage.getItem("debug"):null;("1"===t||"true"===t||(void 0!==l&&l.env,0))&&console.log(...e)}catch(t){}}let u=t=>{var e;let r=null===(e=t.detail)||void 0===e?void 0:e.speed;r&&(!function(t){o=t;try{localStorage.setItem("typewriterSpeed",t)}catch(t){console.warn("\uD83D\uDCA5 Could not save typewriter speed to localStorage:",t)}}(r),d("\uD83D\uDC80 Typewriter speed updated from control panel: ".concat(r)))};function h(t,e){let r=t.trim().replace(/^['"]|['"]$/g,"");return!r||/^(?:[a-z]+:)?\/\//i.test(r)||/^(?:data:|blob:|about:)/i.test(r)||r.startsWith("/")?r:e.replace(/\/[^/]*$/,"/")+r}function m(t,e,r){try{let r=new DOMParser().parseFromString(t,"text/html"),n=document.head;for(let t of(Array.from(document.head.querySelectorAll('[data-chapter-asset="1"]')).forEach(t=>{try{t.remove()}catch(t){}}),Array.from(r.querySelectorAll("link")))){let r=(t.getAttribute("rel")||"").toLowerCase();if(r&&("stylesheet"===r||"preload"===r&&"font"===(t.getAttribute("as")||"").toLowerCase()||"preconnect"===r)){let r=document.createElement("link");r.rel=t.rel;let i=t.getAttribute("href")||"";i&&(r.href=h(i,e));let a=t.getAttribute("as");a&&(r.as=a);let l=t.getAttribute("crossorigin");l&&r.setAttribute("crossorigin",l);let o=t.getAttribute("media");o&&(r.media=o),r.setAttribute("data-chapter-asset","1"),n.appendChild(r)}}for(let t of Array.from(r.querySelectorAll("style"))){let r=document.createElement("style");r.type=t.type||"text/css",r.textContent=function(t,e){return t.replace(/url\(([^)]+)\)/gi,(t,r)=>{let n=h(String(r),e);return"url(".concat(n,")")}).replace(/@import\s+url\(([^)]+)\)/gi,(t,r)=>{let n=h(String(r),e);return"@import url(".concat(n,")")}).replace(/@import\s+['"]([^'\"]+)['"]/gi,(t,r)=>{let n=h(String(r),e);return"@import url(".concat(n,")")})}(t.textContent||"",e),r.setAttribute("data-chapter-asset","1"),n.appendChild(r)}let i=r.body;if(i){let t=(t,r)=>{let n=t.getAttribute(r);n&&t.setAttribute(r,h(n,e))};for(let r of(i.querySelectorAll("img, video, audio, source, track").forEach(e=>t(e,"src")),i.querySelectorAll("a[href]").forEach(t=>{let r=t.getAttribute("href")||"";r.startsWith("#")||/^(?:[a-z]+:)?\/\//i.test(r)||t.setAttribute("href",h(r,e))}),Array.from(i.querySelectorAll("img"))))r.hasAttribute("loading")||r.setAttribute("loading","lazy"),r.hasAttribute("decoding")||r.setAttribute("decoding","async"),r.hasAttribute("fetchpriority")||r.setAttribute("fetchpriority","low");for(let t of Array.from(i.querySelectorAll("video")))t.hasAttribute("preload")||t.setAttribute("preload","metadata");return i.innerHTML}return t}catch(e){return console.warn("chapter assets install failed",e),t}}function y(t){try{["text","log","dialog","title","choice","choice-box"].forEach(e=>t.classList.remove(e))}catch(t){}}async function p(t){var e;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#reader-body",n=document.querySelector(r);if(!n){d("typewriter: no bodyHost");return}let i=n.dataset;if("1"===i.twBusy){d("typewriter: external busy, skipping");return}i.twBusy="1";let a=n.querySelector(".rich-external");a||((a=document.createElement("div")).className="rich-hidden rich-external",a.style.display="none",n.appendChild(a)),a.innerHTML=t||"";try{c(a)}catch(t){}try{let e=document.querySelector("#reader-content"),n="#reader-extra"===r;if(e&&!n){let r=e.querySelector("#rich-master");r||((r=document.createElement("div")).id="rich-master",r.className="rich-hidden",r.style.display="none",e.appendChild(r)),r.innerHTML=t||"";try{c(r)}catch(t){}}}catch(t){}n.classList.add("components-loaded");let l=n.querySelector(".noising-text"),s="#reader-extra"===r;if(s){let t=document.createElement("div");t.className="tw-block",(l=document.createElement("span")).className="noising-text",t.appendChild(l),n.appendChild(t)}else l?l.textContent="":((l=document.createElement("span")).className="noising-text",n.appendChild(l));l.style.whiteSpace="pre-wrap",l.style.display="block";let u=function(t){let e=Array.from(t.querySelectorAll(".rich-hidden")),r=e.length?e[e.length-1]:null;if(!r)return[];let n=r.cloneNode(!0);console.log("\uD83D\uDD0D DEBUG segmentace - před filtrov\xe1n\xedm:",n.innerHTML.substring(0,200)+"...");let i=n.querySelectorAll("p.choice, .choice-box");console.log("\uD83D\uDD0D DEBUG segmentace - našel voleb k odstraněn\xed:",i.length),i.forEach(t=>t.remove());let a=n.querySelectorAll("#story-cache, .hidden");console.log("\uD83D\uDD0D DEBUG segmentace - našel skryt\xfdch elementů:",a.length),a.forEach(t=>t.remove()),console.log("\uD83D\uDD0D DEBUG segmentace - po filtrov\xe1n\xed:",n.innerHTML.substring(0,200)+"...");let l=[],o=t=>/^(P|DIV|H[1-6]|LI|PRE|BLOCKQUOTE|SECTION)$/i.test(t.tagName),c=t=>{let e=t.getAttribute("class")||"";return/(\b|_)(log|dialog|text|title)(\b|_)/.test(e)},s=t=>o(t)||c(t)||"LOG"===t.tagName.toUpperCase(),d=t=>{if("BR"===t.tagName.toUpperCase())return!0;let e=(t.getAttribute("class")||"").trim(),r=(t.getAttribute("style")||"").trim();return!!e||!!r},u=t=>t.replace(/\u00A0/g," ").replace(/\r\n?/g,"\n"),h=(t,e)=>{let r=t.replace(/[\t ]+\n/g,"\n").replace(/\n{3,}/g,"\n\n");if(!r)return;let n=(e.getAttribute("class")||"").trim(),i=e.getAttribute("style")||void 0;l.push({text:r,classes:n,style:i,inline:!1})},m=t=>{let e=u(t.innerText||"");if(!e)return;let r=(t.getAttribute("class")||"").trim(),n=t.getAttribute("style")||void 0;l.push({text:e,classes:r,style:n,inline:!0})},y=t=>{let e="";t.childNodes.forEach(r=>{if(r.nodeType===Node.TEXT_NODE){e+=u(r.textContent||"");return}if(r.nodeType===Node.ELEMENT_NODE){if("BR"===r.tagName.toUpperCase()){e+="\n";return}if(d(r)){h(e,t),e="",m(r);return}if(o(r)){h(e,t),e="",y(r);return}e+=u(r.innerText||"")}}),h(e,t)};if(Array.from(n.childNodes).forEach(t=>{if(t.nodeType===Node.TEXT_NODE){let e=(t.textContent||"").trim();e&&l.push({text:e,classes:"",inline:!1});return}if(t.nodeType===Node.ELEMENT_NODE){if(s(t))y(t);else{let e=t.innerText||"",r=(t.getAttribute("class")||"").trim(),n=t.getAttribute("style")||void 0;e.trim()&&l.push({text:e,classes:r,style:n,inline:!0})}}}),!l.length){let t=(n.innerText||"").trim();t&&l.push({text:t,classes:""})}return l}(n),h=u.filter(t=>!/(^|\s)(choice|choice-box)(\s|$)/.test(t.classes||"")),m=h.length?h.map(t=>t.text):(function(t){let e=t.querySelector(".rich-hidden"),r=t=>t.replace(/&nbsp;|&#160;/gi," ").replace(/\r\n?/g,"\n");if(e){let t=e.cloneNode(!0);t.querySelectorAll("#story-cache, .hidden").forEach(t=>t.remove());let n=r(t.innerHTML||"").replace(/<br\s*\/?>(?=\s*\n?)/gi,"\n").replace(/<\/(p|div|h[1-6]|li)>/gi,"</$1>\n").replace(/<li[^>]*>/gi,"• ").replace(/<style[\s\S]*?<\/style>/gi,"").replace(/<script[\s\S]*?<\/script>/gi,"").replace(/<[^>]+>/g,"").replace(/[\t ]+\n/g,"\n").replace(/\n{3,}/g,"\n\n").trim();return n||(n=r(t.textContent||"").trim()),n}return""})(n).split(/\n/);!u.length&&m.length<=1&&((null===(e=m[0])||void 0===e?void 0:e.length)||0)>300&&(m=m[0].split(RegExp("\\n|(?<=[\\.?!…])\\s+(?=[A-Z\xc1-Ž0-9„(])","u")));let p=m.map(t=>t.length||1),f=p.reduce((t,e)=>t+e,0)||1,g=u.findIndex(t=>/(^|\s)(choice|choice-box)(\s|$)/.test(t.classes||"")),b=Array.from(n.querySelectorAll(".rich-hidden")),v=b.length?b[b.length-1]:null,x=document.getElementById("rich-master"),E=-1;if(x||v){let t=Array.from((x||v).children),e=t;1===t.length&&"SECTION"===t[0].tagName.toUpperCase()&&(e=Array.from(t[0].children));for(let t=0;t<e.length;t++){let r=e[t];if(r.classList.contains("choice-box")||"function"==typeof r.matches&&r.matches("p.choice")){E=t;break}}}let A=g>=0?g:E,L=(()=>{if(A<0)return -1;let t=0;for(let e=0;e<u.length&&e<A;e++){let r=u[e];!/(^|\s)(choice|choice-box)(\s|$)/.test(r.classes||"")&&t++}return t})();L>=0&&m.length>L&&(m=m.slice(0,L));try{0===A&&x&&x.querySelector(":scope > :not(.choice-box):not(p.choice)")&&console.warn("\uD83E\uDDE9 firstChoiceIdx=0, ale #rich-master m\xe1 obsah před volbami – zkontroluj zdroj segmentů.")}catch(t){}let T=()=>{let t=document.getElementById("manifest-container"),e=24e3;if(t){let r=getComputedStyle(t).getPropertyValue("--typewriter-duration").trim();r.endsWith("ms")?e=3.5*parseFloat(r):r.endsWith("s")&&(e=3500*parseFloat(r))}return Math.max(500,e*(({instant:.02,fast:.2,normal:1,slow:6})[o||"normal"]||1))},M=()=>T(),N=()=>{try{var t,e,r;let n="undefined"!=typeof localStorage?localStorage.getItem("synthoma-autoscroll"):null;if(!("1"===n||(null===(r=document)||void 0===r?void 0:null===(e=r.body)||void 0===e?void 0:null===(t=e.dataset)||void 0===t?void 0:t.autoscroll)==="1"))return;window.scrollTo({top:document.documentElement.scrollHeight})}catch(t){}},C=v?(()=>{let t=Array.from(v.children),e=t;return 1===t.length&&"SECTION"===t[0].tagName.toUpperCase()&&(e=Array.from(t[0].children)),e.filter(t=>{let e=!!t.classList&&t.classList.contains("choice-box"),r="function"==typeof t.matches&&t.matches("p.choice");return!(e||r)})})():[],k=!1,D=!1,q=(t,e,r,n,i)=>{let a=e.cloneNode(!0);try{let t=(a.getAttribute("class")||"").trim();/(^|\b)(log|dialog|title|text)(\b|$)/.test(t)||(a.className=(t?t+" ":"")+"text")}catch(t){}t.innerHTML="",t.classList.add("typewriter");let l=document.createElement("span");l.className="noising-text",l.appendChild(a),t.appendChild(l);let s=()=>{let e=o||"normal",r={instant:.1,fast:.6,normal:1.2,slow:4.5}[e]||1.2;t.style.setProperty("--caret-duration","".concat(r,"s")),d("\uD83D\uDC80 Rich HTML caret speed: ".concat(e," (").concat(r,"s)"))};s();let u=()=>{let t=o||"normal",e=Math.max(100,n*(({instant:.02,fast:.2,normal:1,slow:6})[t]||1));return d("\uD83D\uDC80 Rich HTML typing speed: ".concat(t," → ").concat(e,"ms (base: ").concat(n,"ms)")),e};try{c(a)}catch(t){}try{w()}catch(t){}try{let t=window.startGlitching;if("function"==typeof t){let e=a.querySelectorAll(".glitch-master, .glitching");e&&e.length&&t(".glitching")}}catch(t){}let h=t=>{var e;(null===(e=t.detail)||void 0===e?void 0:e.speed)&&(s(),n=u(),d("\uD83D\uDC80 Rich HTML reaguje na změnu rychlosti: ".concat(t.detail.speed)))};document.addEventListener("synthoma:speed-changed",h),n=u();let m=a.textContent||r||"",y=m.split("");if(0===y.length){try{t.classList.remove("typewriter")}catch(t){}try{document.removeEventListener("synthoma:speed-changed",h)}catch(t){}return i(),()=>{}}a.innerHTML="";let p="!@#$%^&*_-+=?/|<>[]{};:~NYHSMT#\xa4%&@\xa7\xf7\xd7\xa4░▒▓█▄▀●◊O|/_^-~.*+",f=[],g=null,b=()=>{if(g){try{clearTimeout(g)}catch(t){}g=null}for(;f.length;){let t=f.pop();if("number"==typeof t)try{clearTimeout(t)}catch(t){}}},v=Math.max(200,n),x=Math.max(8,Math.round(v/Math.max(1,y.length)));d("\uD83D\uDC80 Rich HTML char-by-char: ".concat(y.length," znaků, ").concat(x,"ms per step, total: ").concat(v,"ms"));let S=0,E=()=>{if(A||!a)return;let e=y[S++]||"",r=document.createElement("span");if(r.className="tw-char",e.trim().length>0){let t=p[Math.random()*p.length|0]||e;r.textContent=t;let n=Math.max(12,Math.min(40,Math.round(x/3))),i=Math.max(2,Math.min(4,Math.round(x/n)));for(let t=0;t<i;t++){let i=window.setTimeout(()=>{if(!r||A)return;let t=p[Math.random()*p.length|0]||e;r.textContent=t},t*n);f.push(i)}let a=window.setTimeout(()=>{if(!r||A)return;r.textContent=e;let t=window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches,n=document.body&&document.body.classList.contains("no-animations");if(!t&&!n){r.classList.add("noising-char"),r.classList.add("noising");try{r.classList.add("noising-burst"),window.setTimeout(()=>{try{r.classList.remove("noising-burst")}catch(t){}},200)}catch(t){}}},i*n);f.push(a)}else r.textContent=e;if(e.trim().length>0&&(r.classList.add("tw-glitch"),window.setTimeout(()=>{try{r.classList.remove("tw-glitch")}catch(t){}},Math.max(60,Math.min(140,Math.round(.8*x))))),a.appendChild(r),e.trim().length>0&&.1>Math.random()&&(r.classList.add("tw-split"),window.setTimeout(()=>{try{r.classList.remove("tw-split")}catch(t){}},100)),.06>Math.random()&&(l.classList.add("tw-blip"),window.setTimeout(()=>{try{l.classList.remove("tw-blip")}catch(t){}},100)),S<y.length)g=window.setTimeout(E,x);else{try{l.classList.remove("tw-blip")}catch(t){}b();try{let t=window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches,e=document.body&&document.body.classList.contains("no-animations"),r=m.split(""),n=Array.from(a.querySelectorAll(".tw-char"));for(let i=0;i<r.length;i++){let l=r[i]||"",o=n[i];o||((o=document.createElement("span")).className="tw-char",a.appendChild(o)),o.textContent=l,o.classList.remove("tw-glitch","tw-split","flickering"),t||e||!(l.trim().length>0)?(o.classList.remove("noising"),o.classList.add("noising-char"),l.trim().length>0&&o.classList.add("noising-static")):o.classList.add("noising-char","noising"),l.trim().length>0&&(o.classList.add("noising-burst"),window.setTimeout(()=>{try{o.classList.remove("noising-burst")}catch(t){}},200))}}catch(t){}try{let t=window;"function"==typeof t.startShinning&&t.startShinning()}catch(t){}try{let t=window;"function"==typeof t.startNoising&&t.startNoising()}catch(t){}try{t.classList.remove("typewriter")}catch(t){}try{document.removeEventListener("synthoma:speed-changed",h)}catch(t){}try{i()}catch(t){}g=null}},A=!1;return g=window.setTimeout(E,Math.max(8,Math.round(x))),()=>{try{A=!0}catch(t){}try{b()}catch(t){}try{t.classList.remove("typewriter")}catch(t){}try{document.removeEventListener("synthoma:speed-changed",h)}catch(t){}}},H=(t,e)=>{try{let r=C[e]||null;if(!r)return;k=!0;let n=r.innerHTML||"";t.innerHTML=n,y(t),k=!0;try{c(t)}catch(t){}try{w()}catch(t){}try{let e=Array.from(t.querySelectorAll(".choice-box .choice-link"));e.length&&e.forEach((t,e)=>{t.classList.add("choice-appear"),window.setTimeout(()=>{try{t.classList.add("visible")}catch(t){}window.setTimeout(()=>{try{t.classList.remove("choice-appear")}catch(t){}},380)},800*e)})}catch(t){}try{let e=window.startGlitching,r=t.querySelectorAll(".glitch-master, .glitching"),n=[];r.forEach(t=>{let e=t.dataset;e&&e.glitchInit||(t.classList.add("glitch-to-init"),e&&(e.glitchInit="1"),n.push(t))}),n.length&&"function"==typeof e&&(e(".glitch-to-init"),n.forEach(t=>t.classList.remove("glitch-to-init")))}catch(t){}}catch(t){}},j=(t,e)=>{if(L>=0&&t===m.length&&m.length===L)try{let t=l.parentElement&&l.parentElement.classList.contains("tw-block")?l.parentElement:n;if(v){let e=v.querySelector(".choice-box");if(e){let r=e.cloneNode(!0),n=Array.from(r.querySelectorAll("a.choice-link"));if(n.some(t=>!t.getAttribute("data-next"))){let t=e.nextElementSibling;for(;t&&(t.matches("p.choice")||t.classList.contains("choice-box"));)t=t.nextElementSibling;if(t){t.id||(t.id="auto-block-".concat(Math.random().toString(36).slice(2,8)));let e="#".concat(t.id);n.forEach(t=>{t.getAttribute("data-next")||t.setAttribute("data-next",e)})}}t.appendChild(r);try{c(t)}catch(t){}try{w()}catch(t){}try{Array.from(r.querySelectorAll(".choice-link")).forEach((t,e)=>{t.classList.add("choice-appear"),window.setTimeout(()=>{try{t.classList.add("visible")}catch(t){}window.setTimeout(()=>{try{t.classList.remove("choice-appear")}catch(t){}},380)},140*e)})}catch(t){}D=!0,d("⏸️ Typewriter: volby injektov\xe1ny po dops\xe1n\xed posledn\xedho ř\xe1dku (.choice-box @ end).");try{i.twBusy="0"}catch(t){}return}}try{let e=Array.from((v||n).querySelectorAll("p.choice"));if(e.length){let r=e[0],n=[r],a=r.nextElementSibling;for(;a&&a.matches("p.choice");)n.push(a),a=a.nextElementSibling;let l=n[n.length-1].nextElementSibling;for(;l&&l.matches("p.choice");)l=l.nextElementSibling;let o="";l&&(l.id||(l.id="auto-block-".concat(Math.random().toString(36).slice(2,8))),o=l.id);let s=document.createElement("div");for(let t of(s.className="choice-box",n)){let e=document.createElement("a");e.className="choice-link",e.href="#";try{let r=t.dataset;for(let t in r)Object.prototype.hasOwnProperty.call(r,t)&&e.setAttribute("data-".concat(t),r[t])}catch(t){}!e.getAttribute("data-next")&&o&&e.setAttribute("data-next",o),e.innerHTML=t.innerHTML,s.appendChild(e)}t.appendChild(s);try{c(t)}catch(t){}try{w()}catch(t){}try{Array.from(s.querySelectorAll(".choice-link")).forEach((t,e)=>{t.classList.add("choice-appear"),window.setTimeout(()=>{try{t.classList.add("visible")}catch(t){}window.setTimeout(()=>{try{t.classList.remove("choice-appear")}catch(t){}},380)},140*e)})}catch(t){}D=!0,d("⏸️ Typewriter: volby injektov\xe1ny po dops\xe1n\xed posledn\xedho ř\xe1dku (p.choice @ end).");try{i.twBusy="0"}catch(t){}return}}catch(t){}}catch(t){}if(L>=0&&m.length>0&&t===L&&t<m.length){try{let t=l.parentElement&&l.parentElement.classList.contains("tw-block")?l.parentElement:n;if(v){let e=v.querySelector(".choice-box");if(e){try{let r=e.cloneNode(!0),n=Array.from(r.querySelectorAll("a.choice-link"));if(n.some(t=>!t.getAttribute("data-next"))){let t=e.nextElementSibling;for(;t&&(t.matches("p.choice")||t.classList.contains("choice-box"));)t=t.nextElementSibling;if(t){t.id||(t.id="auto-block-".concat(Math.random().toString(36).slice(2,8)));let e="#".concat(t.id);n.forEach(t=>{t.getAttribute("data-next")||t.setAttribute("data-next",e)})}}t.appendChild(r);try{c(t)}catch(t){}try{w()}catch(t){}try{Array.from(r.querySelectorAll(".choice-link")).forEach((t,e)=>{t.classList.add("choice-appear"),window.setTimeout(()=>{try{t.classList.add("visible")}catch(t){}window.setTimeout(()=>{try{t.classList.remove("choice-appear")}catch(t){}},380)},140*e)})}catch(t){}try{let e=window.startGlitching;if("function"==typeof e){let r=t.querySelectorAll(".glitch-master, .glitching");r&&r.length&&e(".glitching")}}catch(t){}}catch(t){}d("⏸️ Typewriter: zastaveno u voleb (.choice-box). Klikni a svět se ti s\xe1m dop\xedše. \uD83E\uDDEA");try{i.twBusy="0"}catch(t){}return}{let e=Array.from(v.querySelectorAll("p.choice"));if(e.length){let r=e[0],n=[r],a=r.nextElementSibling;for(;a&&a.matches("p.choice");)n.push(a),a=a.nextElementSibling;let l=n[n.length-1].nextElementSibling;for(;l&&l.matches("p.choice");)l=l.nextElementSibling;let o="";l&&(l.id||(l.id="auto-block-".concat(Math.random().toString(36).slice(2,8))),o=l.id);let s=document.createElement("div");for(let t of(s.className="choice-box",n)){let e=document.createElement("a");e.className="choice-link",e.href="#";try{let r=t.dataset;for(let t in r)Object.prototype.hasOwnProperty.call(r,t)&&e.setAttribute("data-".concat(t),r[t])}catch(t){}!e.getAttribute("data-next")&&o&&e.setAttribute("data-next",o),e.innerHTML=t.innerHTML,s.appendChild(e)}t.appendChild(s);try{c(t)}catch(t){}try{w()}catch(t){}try{Array.from(s.querySelectorAll(".choice-link")).forEach((t,e)=>{t.classList.add("choice-appear"),window.setTimeout(()=>{try{t.classList.add("visible")}catch(t){}window.setTimeout(()=>{try{t.classList.remove("choice-appear")}catch(t){}},380)},140*e)})}catch(t){}d("⏸️ Typewriter: zastaveno u voleb (p.choice). Klikni a uvid\xedš, co jsi si nadrobil. \uD83E\uDDEA");try{i.twBusy="0"}catch(t){}return}}}else try{let e=Array.from(n.querySelectorAll("p.choice"));if(e.length){let r=e[0],n=[r],i=r.nextElementSibling;for(;i&&i.matches("p.choice");)n.push(i),i=i.nextElementSibling;let a=n[n.length-1].nextElementSibling;for(;a&&a.matches("p.choice");)a=a.nextElementSibling;let l="";a&&(a.id||(a.id="auto-block-".concat(Math.random().toString(36).slice(2,8))),l=a.id);let o=document.createElement("div");for(let t of(o.className="choice-box",n)){let e=document.createElement("a");e.className="choice-link",e.href="#";try{let r=t.dataset;for(let t in r)Object.prototype.hasOwnProperty.call(r,t)&&e.setAttribute("data-".concat(t),r[t])}catch(t){}!e.getAttribute("data-next")&&l&&e.setAttribute("data-next",l),e.innerHTML=t.innerHTML,o.appendChild(e)}t.appendChild(o);try{c(t)}catch(t){}try{w()}catch(t){}try{Array.from(o.querySelectorAll(".choice-link")).forEach((t,e)=>{t.classList.add("choice-appear"),window.setTimeout(()=>{try{t.classList.add("visible")}catch(t){}window.setTimeout(()=>{try{t.classList.remove("choice-appear")}catch(t){}},380)},140*e)})}catch(t){}d("⏸️ Typewriter: fallback volby z bodyHost (p.choice).")}}catch(t){}}catch(t){}try{i.twBusy="0"}catch(t){}return}if(t>=m.length){e();return}let r=m[t],a=document.createElement("span");a.style.whiteSpace="pre-wrap";let s=u[t],h=!!(s&&s.inline);a.style.display=h?"inline":"block";let g=!!C[t];if(!g&&s){if(s.classes&&(a.className=s.classes+" tw-line"),s.style)try{a.style.cssText+=";"+s.style,a.style.whiteSpace="pre-wrap",a.style.display=h?"inline":"block"}catch(t){}}else a.classList.add("tw-line"),y(a);if(!g&&!h){let t=a.className||"";/(^|\b)(log|dialog|title|text)(\b|$)/.test(t)||(a.className=(t?t+" ":"")+"text tw-line")}let b=o||"normal";"instant"===b&&a.classList.add("typewriter-instant"),l.appendChild(a),N();let x=p[t]/f,E=Math.max(250,Math.round(M()*x)),A=Math.min(5e3,Math.max(250,22*(r.length||1)));if(E=Math.min(E,A),(null==s?void 0:s.classes)&&(s.classes.includes("log")&&(E*=.7),s.classes.includes("dialog")&&(E*=1.2),s.classes.includes("title")&&(E*=1.5)),!r||""===r.trim()){window.setTimeout(()=>j(t+1,e),10);return}if("instant"===b){let n=C[t];if(n)try{let t=n.cloneNode(!0);try{let e=(t.getAttribute("class")||"").trim();/(^|\b)(log|dialog|title|text)(\b|$)/.test(e)||(t.className=(e?e+" ":"")+"text")}catch(t){}a.innerHTML="",y(a),a.appendChild(t);try{c(a)}catch(t){}try{w()}catch(t){}try{let t=window.startGlitching;if("function"==typeof t){let e=a.querySelectorAll(".glitch-master, .glitching");e&&e.length&&t(".glitching")}}catch(t){}}catch(t){}else{let e=document.createElement("span");e.className="noising-text",e.textContent=r,a.appendChild(e),H(a,t)}window.setTimeout(()=>j(t+1,e),10);return}let T=C[t];if(T)d("\uD83C\uDFAF Rich progressive typing pro ř\xe1dek ".concat(t," (").concat(r.slice(0,30),"...)")),y(a),k=!0,q(a,T,r,E,()=>{N(),j(t+1,e)});else{d("\uD83D\uDC80 Rich HTML fallback: char-by-char pro ř\xe1dek ".concat(t," (").concat(r.slice(0,50),"...)"));let n=document.createElement("span");n.className="noising-text",a.appendChild(n),a.classList.add("typewriter"),S({text:r,host:a,getDurationMs:()=>{let t=o||"normal",e=Math.max(500,E),r=e*(({instant:.05,fast:.3,normal:1,slow:4})[t]||1);return d("\uD83D\uDC80 Fallback speed: ".concat(t," → ").concat(r,"ms (base: ").concat(e,"ms)")),r},onStart:()=>{d("\uD83D\uDC80 Fallback typing start: ".concat(r.slice(0,30),"..."))},onDone:()=>{d("\uD83D\uDC80 Fallback typing done: ".concat(r.slice(0,30),"..."));try{a.classList.remove("typewriter")}catch(t){}N(),H(a,t),j(t+1,e)}})}};d("typewriter: external start",{lines:m.length,speed:void 0!==o?o:localStorage.getItem("typewriterSpeed")||"normal"}),j(0,()=>{d("typewriter: external done");try{i.twBusy="0"}catch(t){}try{if(k||D)return;let t=n.querySelector(".rich-hidden");if(t){let e=window.startGlitching,r=document.createElement("div");r.innerHTML=t.innerHTML;let i=Array.from(r.childNodes),a=document.createDocumentFragment(),o=t=>{t.appendChild(a);try{if("function"==typeof e){let r=t.querySelectorAll(".glitch-master, .glitching");r&&r.length&&e(".glitching")}}catch(t){}},d=t=>{let e=0;for(;i.length&&e<20;){let t=i.shift();a.appendChild(t),e++}o(t),i.length&&("requestIdleCallback"in window?window.requestIdleCallback(()=>d(t),{timeout:32}):setTimeout(()=>d(t),16))};if(s){let t=(l.parentElement&&l.parentElement.classList.contains("tw-block")?l.parentElement:null)||n;try{l.remove()}catch(t){}d(t);try{c(t)}catch(t){}try{w()}catch(t){}}else{try{n.replaceChildren()}catch(t){n.innerHTML=""}d(n);try{c(n)}catch(t){}try{w()}catch(t){}}}}catch(t){}})}async function f(){var t;let e=(null===(t=l.env)||void 0===t?void 0:"/SynThoma")||"",r=await fetch("".concat(e,"/data/SYNTHOMAINFO.html"),{cache:"no-store"}),n=m(await r.text(),"".concat(e,"/data/"),"info");try{let t=document.querySelector("#reader-content");if(t){g(t).innerHTML=n||"";let e=t.querySelector("#rich-master");e||((e=document.createElement("div")).id="rich-master",e.className="rich-hidden",e.style.display="none",t.appendChild(e)),e.innerHTML=n||"";try{c(e)}catch(t){}}}catch(t){}await p(n,"#reader-extra")}function g(t){let e=t.querySelector("#story-cache");return e||((e=document.createElement("div")).id="story-cache",e.style.display="none",t.appendChild(e)),e}function w(){let t=document.querySelector("#reader-content");if(!t)return;let e=t.dataset;e.interactiveHandlers||(e.interactiveHandlers="1",t.addEventListener("click",t=>{var e;let r=t.target;if(!r)return;let n=r.closest("a.choice-link");if(!n)return;t.preventDefault();let i=n.closest(".choice-box");if(!i||"1"===i.getAttribute("data-locked"))return;try{Array.from(i.querySelectorAll("a.choice-link")).forEach(t=>{t.setAttribute("aria-disabled","true"),t.classList.add("disabled"),t.style.pointerEvents="none",t.removeAttribute("aria-current")}),n.classList.add("selected"),n.setAttribute("aria-current","true"),i.setAttribute("data-locked","1")}catch(t){}let a=n.getAttribute("data-next")||"";if(!a){console.warn("\uD83E\uDEA6 Ž\xe1dn\xfd data-next. Volba vede do pr\xe1zdna.");return}let o=a.replace(/^#+/,""),c=window;c.__synthomaStory=c.__synthomaStory||{visited:new Set,current:""},c.__synthomaStory.visited.add(o);let u=document.querySelector("#reader-content");if(!u)return;let h=u.querySelector("#story-cache");try{let t=h?h.querySelector("section.story-block#".concat(CSS.escape(o))):null,r=t?(t.getAttribute("data-import")||"").trim():"";if(t&&r){if("1"===t.getAttribute("data-import-loaded"));else{t.setAttribute("data-import-loaded","1");let i=(null===(e=l.env)||void 0===e?void 0:"/SynThoma")||"",a=window,o=a.__synthomaStory&&a.__synthomaStory.book?String(a.__synthomaStory.book):"SYNTHOMA-NULL",c=/\//.test(r)?"".concat(i,"/").concat(r.replace(/^\/+/,"")):"".concat(i,"/books/").concat(encodeURIComponent(o),"/").concat(r),s=c.replace(/[^\/]*$/,"");fetch(c,{cache:"no-store"}).then(t=>t.text()).then(t=>{let e=m(t,s,"".concat(o,":").concat(r));try{b(o,r,e)}catch(t){}}).catch(t=>{console.warn("\uD83E\uDDF1 Import kapitoly selhal:",r,t);try{let t=n.closest(".choice-box");t&&(t.removeAttribute("data-locked"),Array.from(t.querySelectorAll("a.choice-link")).forEach(t=>{t.removeAttribute("aria-disabled"),t.classList.remove("disabled"),t.style.pointerEvents=""}))}catch(t){}});return}}}catch(t){}let y=null;if(h){let t=h.querySelector("section.story-block#".concat(CSS.escape(o)));t&&(y=t.outerHTML)}if(!y){let t=document.getElementById(o),e=Array.from(u.querySelectorAll("#rich-master, .rich-hidden")),r=null;for(let t=e.length-1;t>=0;t--){let n=e[t].querySelector("#".concat(CSS.escape(o)));if(n){r=n;break}}if(r||(r=t),r===t&&t){let n=(t.innerText||"").trim().slice(0,64),i=t.tagName;for(let t=e.length-1;t>=0;t--){let a=Array.from(e[t].children).find(t=>t.tagName===i&&(t.innerText||"").trim().startsWith(n));if(a){r=a;break}}}if(r){if("SECTION"===(r.tagName||"").toUpperCase())y=r.innerHTML;else{let t=document.createElement("div"),e=r.closest("#rich-master")||r.closest(".rich-hidden")||r.parentElement,n=e=>t.appendChild(e.cloneNode(!0)),i=r,a=t=>{if(!t)return null;let r=t.nextElementSibling,n=t.parentElement;for(;n&&n!==e;){if(r=n.nextElementSibling)return r;n=n.parentElement}return null};for(;i;){n(i);let t=a(i);if(t&&t.matches("p.choice")){let e=t;for(;e&&e.matches("p.choice");)n(e),e=e.nextElementSibling;e&&!e.matches("p.choice")&&n(e);break}i=a(i)}y=t.innerHTML}}}if(!y){console.warn("\uD83E\uDDF1 Blok nenalezen (ani v cache, ani v DOM):",o);try{let t=n.closest(".choice-box");t&&(t.removeAttribute("data-locked"),Array.from(t.querySelectorAll("a.choice-link")).forEach(t=>{t.removeAttribute("aria-disabled"),t.classList.remove("disabled"),t.style.pointerEvents=""}))}catch(t){}return}try{s(()=>{try{let t=document.querySelector("#reader-content");if(!t)return;let e=t.querySelector("#story-cache");if(!e)return;let r=e.querySelector("section.story-block#".concat(CSS.escape(o)));if(!r)return;let n=[...Array.from(r.querySelectorAll("img[src]")),...Array.from(r.querySelectorAll("video[src], audio[src], source[src], track[src]"))],i=document.head||document.getElementsByTagName("head")[0];for(let t of n){let e=t.getAttribute("src")||"";if(e&&!i.querySelector('link[rel="prefetch"][href="'.concat(e,'"]'))){let t=document.createElement("link");t.rel="prefetch",t.href=e,t.as="fetch",t.crossOrigin="anonymous",i.appendChild(t)}}d("\uD83D\uDD2E Prefetched assets for next block:",o,n.length)}catch(t){}})}catch(t){}p(y,"#reader-extra").catch(()=>{})},!0))}async function b(t,e,r){let n=document.querySelector("#reader-content");if(!n)return;let i=g(n);i.innerHTML=r||"";try{let t=n.querySelector("#rich-master");t||((t=document.createElement("div")).id="rich-master",t.className="rich-hidden",t.style.display="none",n.appendChild(t)),t.innerHTML=r||"";try{c(t)}catch(t){}}catch(t){}let a=i.querySelector("section.story-block#b1")||i.querySelector("section.story-block");if(!a){console.warn("\uD83E\uDEA6 Nebyly nalezeny ž\xe1dn\xe9 story-block sekce, pad\xe1m zpět na norm\xe1ln\xed režim."),await p(r,"#reader-extra");return}try{let r=window;r.__synthomaStory={visited:new Set,current:a.id||"b1",book:t,file:e},a.id&&r.__synthomaStory.visited.add(a.id)}catch(t){}w(),await p(a.outerHTML,"#reader-extra")}async function v(t,e){let r="/books/".concat(encodeURIComponent(t),"/").concat(encodeURIComponent(e)),n="/books/".concat(encodeURIComponent(t),"/"),i=await fetch(r,{cache:"no-store"});if(!i.ok)throw Error("HTTP ".concat(i.status));let a=m(await i.text(),n,"chapter:".concat(t,"/").concat(e));/<section[^>]*class=["'][^"']*\bstory-block\b/i.test(a)?(d("\uD83C\uDFAE Interaktivn\xed kapitola detekov\xe1na – spoušt\xedm story flow"),await b(t,e,a)):await p(a,"#reader-extra")}async function x(t){try{let t=document.querySelector("#reader-extra");t&&(t.innerHTML="")}catch(t){}await v("SYNTHOMA-NULL","0-∞ [RESTART].html")}function S(t){var e,r,n;let{text:i,host:a,getDurationMs:l,onStart:o,onDone:c}=t,s=null===(e=(r=window).matchMedia)||void 0===e?void 0:e.call(r,"(prefers-reduced-motion: reduce)").matches,d="undefined"!=typeof document&&(null===(n=document.body)||void 0===n?void 0:n.classList.contains("no-animations")),u=a.querySelector(".noising-text");if(!u)return()=>{};let h=[],m=null,y=()=>{if(m){try{clearTimeout(m)}catch(t){}m=null}for(;h.length;){let t=h.pop();if("number"==typeof t)try{clearTimeout(t)}catch(t){}}};if(s||d){if(o)try{o()}catch(t){}for(let t of(u.textContent="",i.split(""))){let e=document.createElement("span");e.className="tw-char noising-char",e.textContent=t,t.trim().length>0&&e.classList.add("noising-static"),u.appendChild(e)}if(c)try{c()}catch(t){}return y}if(o)try{o()}catch(t){}u.textContent="";let p=i.split("");try{let t=window;"function"==typeof t.startShinning&&t.startShinning()}catch(t){}let f=7200;try{l&&(f=Math.max(100,l()))}catch(t){}let g=Math.max(12,Math.round(f/Math.max(1,p.length))),w="!@#$%^&*_-+=?/|<>[]{};:~NYHSMT#\xa4%&@\xa7\xf7\xd7\xa4░▒▓█▄▀●◊O|/_^-~.*+",b=0,v=()=>{if(!u)return;let t=p[b++]||"",e=document.createElement("span");if(e.className="tw-char",t.trim().length>0){let r=w[Math.random()*w.length|0]||t;e.textContent=r;let n=Math.max(18,Math.min(48,Math.round(g/3))),i=Math.max(2,Math.min(5,Math.round(g/n)));for(let r=0;r<i;r++){let i=window.setTimeout(()=>{if(!e)return;let r=w[Math.random()*w.length|0]||t;e.textContent=r},r*n);h.push(i)}let a=window.setTimeout(()=>{if(!e)return;e.textContent=t;let r=window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches,n=document.body&&document.body.classList.contains("no-animations");if(!r&&!n){e.classList.add("noising-char"),e.classList.add("noising");try{e.classList.add("noising-burst"),window.setTimeout(()=>{try{e.classList.remove("noising-burst")}catch(t){}},200)}catch(t){}}},i*n);h.push(a)}else e.textContent=t;if(t.trim().length>0&&(e.classList.add("tw-glitch"),window.setTimeout(()=>{e.classList.remove("tw-glitch")},Math.max(80,Math.min(180,Math.round(.9*g))))),u.appendChild(e),t.trim().length>0&&.1>Math.random()&&(e.classList.add("tw-split"),window.setTimeout(()=>{e.classList.remove("tw-split")},120)),.06>Math.random()&&(u.classList.add("tw-blip"),window.setTimeout(()=>{u.classList.remove("tw-blip")},120)),b<p.length)m=window.setTimeout(v,g);else{try{u.classList.remove("tw-blip")}catch(t){}for(;h.length;){let t=h.pop();if("number"==typeof t)try{clearTimeout(t)}catch(t){}}try{let t=window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches,e=document.body&&document.body.classList.contains("no-animations"),r=i.split(""),n=Array.from(u.querySelectorAll(".tw-char"));for(let i=0;i<r.length;i++){let a=r[i]||"",l=n[i];l||((l=document.createElement("span")).className="tw-char",u.appendChild(l)),l.textContent=a,l.classList.remove("tw-glitch","tw-split","flickering"),t||e||!(a.trim().length>0)?(l.classList.remove("noising"),l.classList.add("noising-char"),a.trim().length>0&&l.classList.add("noising-static")):l.classList.add("noising-char","noising"),a.trim().length>0&&(l.classList.add("noising-burst"),window.setTimeout(()=>{try{l.classList.remove("noising-burst")}catch(t){}},200))}n=Array.from(u.querySelectorAll(".tw-char"));for(let t=n.length-1;t>=r.length;t--)n[t].remove()}catch(t){}try{let t=window;"function"==typeof t.startShinning&&t.startShinning()}catch(t){}try{let t=window;"function"==typeof t.startNoising&&t.startNoising()}catch(t){}if(c)try{c()}catch(t){}m=null}};return m=window.setTimeout(v,Math.max(10,Math.round(g))),y}"undefined"!=typeof document&&(document.removeEventListener("synthoma:speed-changed",u),document.addEventListener("synthoma:speed-changed",u),d("\uD83D\uDC80 Global speed change listener attached"));let E="SYNTHOMA",A="Tma nikdy nen\xed opravdov\xe1, je jen světlem, kter\xe9 se vzdalo smyslu.",L="Pokračovat";function T(){let[t,e]=(0,i.useState)(!1),[r,l]=(0,i.useState)(!1),[o,c]=(0,i.useState)(!1),[s,d]=(0,i.useState)(!1),[u,h]=(0,i.useState)(!1),[m,y]=(0,i.useState)(!1),[p,g]=(0,i.useState)(!1),w=(0,i.useRef)(!1),b=(0,i.useRef)(!1),[v,T]=(0,i.useState)(!1),M=(0,i.useRef)(null),N=(0,i.useRef)(null),C=(0,i.useRef)(null),k=(0,i.useRef)(!1);(0,i.useEffect)(()=>{let t=window.setTimeout(()=>e(!0),30),r=window.setTimeout(()=>l(!0),4100);return()=>{window.clearTimeout(t),window.clearTimeout(r)}},[]),(0,i.useEffect)(()=>{if(!u){w.current=!1,b.current=!1;return}if(w.current)return;w.current=!0,y(!1),g(!1);let t=document.querySelector("#reader-dialog");if(!t)return;if(t){let e;(e=t.querySelector(".noising-text"))?e.textContent="":((e=document.createElement("span")).className="noising-text",t.appendChild(e))}let e=null;return e=S({text:"„V\xedtej v SYNTHOMĚ, @&SĐYŁ !!! Tady jm\xe9no nikoho nezaj\xedm\xe1, ale chyby? Ty jsou v paměti věčně.“",host:t,getDurationMs:()=>{let t=document.getElementById("manifest-container");if(t){let e=getComputedStyle(t).getPropertyValue("--typewriter-duration").trim();if(e.endsWith("ms"))return .7*parseFloat(e);if(e.endsWith("s"))return 700*parseFloat(e)}return 5200},onStart:()=>{let e=Array.from(t.querySelectorAll(".sr-only .glitching")).map(t=>t.textContent||"").filter(t=>t&&t.trim().length>0);if(!e.length)return;let r=0,n=new Set,i=window.setInterval(()=>{r++;try{let r=t.querySelector(".noising-text");if(!r)return;let a=Array.from(r.querySelectorAll(".tw-char"));if(!a.length)return;let l=a.map(t=>t.textContent||"").join("");for(let t of e){if(n.has(t))continue;let e=l.indexOf(t);if(-1!==e){let r=document.createElement("span");r.className="glitching";let i=a[e],l=i&&i.parentNode;if(l&&i){l.insertBefore(r,i);for(let r=0;r<t.length&&e+r<a.length;r++){let t=a[e+r];t&&t.classList.add("tw-char-hidden")}r.textContent=t;try{let t=window;t.startGlitching&&t.startGlitching(".glitching")}catch(t){}n.add(t)}}}n.size===e.length&&window.clearInterval(i)}catch(t){}if(r>220)try{window.clearInterval(i)}catch(t){}},120)},onDone:()=>{y(!0)}}),()=>{try{e&&e()}catch(t){}try{let t=window;t.stopGlitching&&t.stopGlitching(".glitching")}catch(t){}}},[u]),(0,i.useEffect)(()=>{if(!u||!m||b.current)return;b.current=!0;let t=document.querySelector("#reader-title"),e=document.querySelector("#reader-body"),r=document.querySelector("#reader-dialog");if(!t||!r){console.log("typewriter: missing hosts",{title:!!t,body:!!e,userDialog:!!r});return}let n=()=>{try{window.scrollTo({top:document.documentElement.scrollHeight,behavior:"smooth"})}catch(t){}};function i(t){let e=t.querySelector(".noising-text");return e?(e.style.whiteSpace="pre-wrap",e.style.display="block"):((e=document.createElement("span")).className="noising-text",e.style.whiteSpace="pre-wrap",e.style.display="block",t.appendChild(e)),e}t&&i(t),e&&i(e);let a=t=>{let e=t.querySelector(".rich-hidden"),r=t=>t.replace(/&nbsp;|&#160;/gi," ").replace(/\r\n?/g,"\n");if(e){let t=e.cloneNode(!0);t.querySelectorAll("#story-cache, .hidden").forEach(t=>t.remove());let n=r(t.innerHTML||"").replace(/<br\s*\/>?/gi,"\n").replace(/<\/(p|div|h[1-6]|li)>/gi,"</$1>\n").replace(/<li[^>]*>/gi,"• ").replace(/<style[\s\S]*?<\/style>/gi,"").replace(/<script[\s\S]*?<\/script>/gi,"").replace(/<[^>]+>/g,"").replace(/[\t ]+\n/g,"\n").replace(/\n{3,}/g,"\n\n").trim();return n||(n=r(t.textContent||"").trim()),n}let n=t.querySelector(".sr-only");return n?r(n.textContent||"").trim():""},l=t=>{let e=t.querySelector(".rich-hidden");if(e){t.innerHTML=e.innerHTML;try{let e=window.startGlitching,r=t.querySelectorAll(".glitch-master, .glitching"),n=[];r.forEach(t=>{let e=t.dataset;e&&e.glitchInit||(t.classList.add("glitch-to-init"),e&&(e.glitchInit="1"),n.push(t))}),n.length&&"function"==typeof e&&(e(".glitch-to-init"),n.forEach(t=>t.classList.remove("glitch-to-init")))}catch(t){}}},o=null,c=null;return o=S({text:a(t),host:t,getDurationMs:()=>1400,onStart:()=>{},onDone:()=>{if(g(!0),l(t),!e){console.log("typewriter: no bodyHost, skipping body and not repeating log/dialog");return}console.log("typewriter: title done, starting body");let r=a(e);console.log("typewriter: body fullText",{len:r.length,sample:r.slice(0,120)});let i=r.split(/\n/);if(i.length<=1&&r.length>300&&(i=r.split(RegExp("\\n|(?<=[\\.!?…])\\s+(?=[A-Z\xc1-Ž0-9„(])","u"))),!r||!r.trim()){console.log("typewriter: body empty, skipping without repeating log/dialog");return}let o=e.querySelector(".noising-text");o||((o=document.createElement("span")).className="noising-text",e.appendChild(o)),o&&(o.style.whiteSpace="pre-wrap",o.style.display="block"),console.log("typewriter: body start",{lines:i.length,sample:i.slice(0,3)});let s=(()=>{let t=document.getElementById("manifest-container");if(t){let e=getComputedStyle(t).getPropertyValue("--typewriter-duration").trim();if(e.endsWith("ms"))return 3.5*parseFloat(e);if(e.endsWith("s"))return 3500*parseFloat(e)}return 24e3})(),d=i.map(t=>t.length||1),u=d.reduce((t,e)=>t+e,0)||1,h=[],m=!1,y=(t,e)=>{if(m)return;if(t>=i.length){e();return}let r=i[t],a=document.createElement("span");a.style.whiteSpace="pre-wrap",a.style.display="block",o&&(o.appendChild(a),n());let l=Math.max(250,Math.round(d[t]/u*s)),c=Math.min(5e3,Math.max(250,22*(r.length||1)));if(l=Math.min(l,c),0===t)try{console.log("typewriter: body line0",{len:r.length,dur:l})}catch(t){}if(!r||""===r.trim()){window.setTimeout(()=>y(t+1,e),10);return}let p=S({text:r,host:a,getDurationMs:()=>l,onStart:()=>{},onDone:()=>{n(),y(t+1,e)}});h.push(p)};c=()=>{m=!0;try{h.forEach(t=>{t&&t()})}catch(t){}};try{y(0,()=>{m||n()})}catch(t){console.error("typewriter: body sequence error",t)}}}),()=>{try{o&&o()}catch(t){}try{c&&c()}catch(t){}}},[u,m]),(0,i.useEffect)(()=>{if("undefined"==typeof document)return;let t=null,e=null,r=null,n=e=>{if(!t)return;let r=t.offsetWidth,n=t.offsetHeight,i=window.innerWidth,a=window.innerHeight,l=e.clientX+15,o=e.clientY+15;l+r+10>i&&(l=i-r-10),l<10&&(l=10),o+n+10>a&&(o=a-n-10),o<10&&(o=10),t.style.left="".concat(l,"px"),t.style.top="".concat(o,"px")},i=()=>{t&&(t.remove(),t=null),e&&(clearTimeout(e),e=null),document.removeEventListener("mousemove",n),window.removeEventListener("scroll",i),r=null},a=(r,a)=>{var l,o;t&&i();let c=null===(l=r.dataset)||void 0===l?void 0:l.short,s=null===(o=r.dataset)||void 0===o?void 0:o.long;if(!c){console.warn("popup-tip: chyb\xed data-short");return}console.debug("popup-tip: show",{shortText:c,longText:s,target:r}),(t=document.createElement("div")).className="popup-container",t.style.position="fixed",t.style.pointerEvents="none",t.style.opacity="0",t.style.zIndex="3000";let d=document.createElement("p");d.className="popup-text",d.textContent=c,t.appendChild(d),document.body.appendChild(t),n(a),t.style.opacity="1",document.addEventListener("mousemove",n),window.addEventListener("scroll",i,{once:!0}),s&&(e=setTimeout(()=>{if(t){let e=t.querySelector(".popup-text");e&&(e.textContent=s),n(a)}},3500))},l=(r,i)=>{var l;t||a(r,i);let o=null===(l=r.dataset)||void 0===l?void 0:l.long;if(o&&t){e&&(clearTimeout(e),e=null);let r=t.querySelector(".popup-text");r&&(r.textContent=o),n(i)}},o=e=>{var l;let o=null===(l=e.target)||void 0===l?void 0:l.closest(".popup-tip");if(!o){let t=Array.from(document.querySelectorAll('[class*="glitch"]')).filter(t=>!t.closest(".popup-tip")),r=[];t.forEach(t=>{r.push([t,t.style.pointerEvents]),t.style.pointerEvents="none"});try{let t=document.elementFromPoint(e.clientX,e.clientY);o=t?t.closest(".popup-tip"):null}finally{r.forEach(t=>{let[e,r]=t;e.style.pointerEvents=r})}}o!==r&&(r&&i(),o&&a(o,e),r=o),t&&n(e)},c=t=>{var e;let n=null===(e=t.target)||void 0===e?void 0:e.closest(".popup-tip");n&&(r=n,a(n,t))},s=t=>{var e;let n=null===(e=t.target)||void 0===e?void 0:e.closest(".popup-tip");n&&n===r&&(i(),r=null)},d=t=>{var e;let n=r||(null===(e=t.target)||void 0===e?void 0:e.closest(".popup-tip"));n&&l(n,t)};return document.body.addEventListener("mousemove",o),document.body.addEventListener("pointerenter",c,!0),document.body.addEventListener("pointerleave",s,!0),document.body.addEventListener("click",d),()=>{i(),document.body.removeEventListener("mousemove",o),document.body.removeEventListener("pointerenter",c,!0),document.body.removeEventListener("pointerleave",s,!0),document.body.removeEventListener("click",d)}},[]),(0,i.useEffect)(()=>{if(!s)return;let t=C.current;if(!t)return;let e=t.querySelector(".glitch-real");if(!e)return;let r=e.querySelector(".noising-text");r?r.textContent="":((r=document.createElement("span")).className="noising-text",e.appendChild(r));let n=t.querySelector(".glitch-fake1"),i=t.querySelector(".glitch-fake2");n&&(n.textContent=""),i&&(i.textContent="");let a=S({text:L,host:e,getDurationMs:()=>{let t=document.getElementById("manifest-container");if(t){let e=getComputedStyle(t).getPropertyValue("--typewriter-duration").trim();if(e.endsWith("ms"))return .35*parseFloat(e);if(e.endsWith("s"))return 350*parseFloat(e)}return 2200},onStart:()=>{},onDone:()=>{n&&(n.textContent=L),i&&(i.textContent=L);try{let t=window;t.startShinning&&t.startShinning()}catch(t){}try{let t=window;t.startNoising&&t.startNoising()}catch(t){}}});return()=>{try{a()}catch(t){}}},[s]),(0,i.useEffect)(()=>{try{let t=(0,a.G)();N.current=t,T(()=>!!t&&!t.paused&&!t.ended&&t.currentTime>0);let e=()=>T(!0),r=()=>T(!1),n=()=>T(!1);return t.addEventListener("play",e),t.addEventListener("pause",r),t.addEventListener("ended",n),()=>{try{t.removeEventListener("play",e),t.removeEventListener("pause",r),t.removeEventListener("ended",n)}catch(t){}}}catch(t){}},[]);let D=async()=>{try{let t=window.audioPanelEnsurePlaying;if("function"==typeof t)k.current||(k.current=!0,t(),sessionStorage.setItem("synthoma_play_audio","1"),setTimeout(()=>{k.current=!1},150));else{let t=N.current||(0,a.G)();t&&(t.paused||t.ended||0===t.currentTime)&&!k.current&&(k.current=!0,await t.play().catch(()=>{}),sessionStorage.setItem("synthoma_play_audio","1"),setTimeout(()=>{k.current=!1},150))}}catch(t){}h(!0);try{let t=window;t.stopShinning&&t.stopShinning()}catch(t){}};(0,i.useEffect)(()=>{if(!t)return;let e=M.current;if(!e)return;let r=function(t){var e,r;let n=null===(e=(r=window).matchMedia)||void 0===e?void 0:e.call(r,"(prefers-reduced-motion: reduce)").matches,i=t.querySelector(".glitch-real"),a=Array.from(t.querySelectorAll(".glitch-char")),l=[],o=(t,e)=>{let r=window.setTimeout(t,e);return l.push(r),r},c=()=>{for(;l.length;){let t=l.pop();if("number"==typeof t)try{clearTimeout(t)}catch(t){}}};try{t.style.opacity="0",t.style.transform="translateY(10px) scale(0.97)",t.style.filter="brightness(0.85) saturate(0.9)",t.style.animation="none",i&&(i.style.willChange="opacity, filter, clip-path, transform"),a.forEach(t=>{t.style.opacity="0",t.style.transition="opacity 240ms ease, filter 240ms ease"})}catch(t){}if(o(()=>{try{t.style.transition="opacity 800ms ease, transform 1000ms cubic-bezier(.2,.9,.1,1), filter 1000ms ease"}catch(t){}},10),o(()=>{try{t.style.opacity="0.12",t.style.transform="translateY(4px) scale(0.985)",t.style.filter="brightness(0.95) saturate(1.02)"}catch(t){}},40),o(()=>{try{t.style.opacity="0.35",t.style.transform="translateY(2px) scale(0.995)",t.style.filter="brightness(1.02) saturate(1.06)"}catch(t){}},450),n)o(()=>{try{t.style.transition="opacity 1200ms ease, transform 1200ms ease",t.style.opacity="1",t.style.transform="none"}catch(t){}},30);else{o(()=>{try{t.style.opacity="0.6",t.style.transform="translateY(0px) scale(1.006)",t.style.filter="brightness(1.08) saturate(1.12)"}catch(t){}},1200),o(()=>{try{t.style.opacity="0.75",t.style.transform="translateY(0) scale(1.01)",t.style.filter="brightness(1.12) saturate(1.18)"}catch(t){}},2e3);let e=performance.now()+1200,r=Math.max(1,a.length),n=()=>{let t=Math.min(1,Math.max(0,(performance.now()-e)/1600));try{i&&(i.style.clipPath="inset(0 ".concat(100-100*t,"% 0 0)"))}catch(t){}for(let e of a.slice(0,Math.floor(t*r)))e&&"1"!==e.style.opacity&&(e.style.opacity="1",e.style.filter="brightness(1.08)",o(()=>{try{e.style.filter=""}catch(t){}},160));t<1&&o(n,16)};o(n,1220),o(()=>{try{t.style.filter="brightness(1.2) saturate(1.25)"}catch(t){}},3100),o(()=>{try{t.style.filter="brightness(1.0) saturate(1.15)"}catch(t){}},3260),o(()=>{try{t.style.filter="brightness(1.22) saturate(1.28)"}catch(t){}},3480),o(()=>{try{t.style.filter="var(--filter-primary)",t.style.transform="none"}catch(t){}},3800),o(()=>{try{t.style.animation="glitch 1.2s linear 0s infinite alternate-reverse",i&&(i.style.clipPath="")}catch(t){}},4e3)}return()=>{c();try{t.style.transition="",t.style.textShadow="",t.style.transform="",t.style.filter="",t.style.animation="",i&&(i.style.clipPath=""),a.forEach(t=>{t.style.opacity="",t.style.transition=""})}catch(t){}}}(e);return()=>{try{r()}catch(t){}}},[t]);let q=(0,i.useMemo)(()=>String(A.length),[]);return(0,i.useEffect)(()=>{let t=document.getElementById("manifest-container");t&&(t.style.setProperty("--typewriter-steps",q),t.style.setProperty("--typewriter-duration","7.2s"),t.style.setProperty("--caret-duration","1.4s"))},[q]),(0,i.useEffect)(()=>{if(!r)return;let t=document.getElementById("manifest-container");if(!t)return;let e=S({text:A,host:t,getDurationMs:()=>{let e=getComputedStyle(t).getPropertyValue("--typewriter-duration").trim();return e.endsWith("ms")?parseFloat(e):e.endsWith("s")?1e3*parseFloat(e):7200},onStart:()=>c(!1),onDone:()=>c(!0)});return()=>{try{e()}catch(t){}}},[r]),(0,i.useEffect)(()=>{var t;if(!o||(null===(t=document.body)||void 0===t?void 0:t.classList.contains("no-animations")))return;let e=0,r=()=>{try{let t=window;"function"==typeof t.startShinning&&t.startShinning()}catch(t){}},n=window.setInterval(()=>{e++,"function"==typeof window.startShinning&&(r(),window.clearInterval(n)),e>40&&window.clearInterval(n)},50);return()=>{window.clearInterval(n)}},[o]),(0,i.useEffect)(()=>{var t,e,r;if(!o)return;let n=window.setTimeout(()=>d(!0),300),i=null===(t=(e=window).matchMedia)||void 0===t?void 0:t.call(e,"(prefers-reduced-motion: reduce)").matches,a="undefined"!=typeof document&&(null===(r=document.body)||void 0===r?void 0:r.classList.contains("no-animations"));if(i||a)return;let l=null,c=document.querySelector("#manifest-container .noising-text");if(c)return l=window.setInterval(()=>{let t=c.querySelectorAll(".noising-char");if(!t||!t.length)return;let e=1+Math.floor(3*Math.random());for(let r=0;r<e;r++){let e=Math.floor(Math.random()*t.length),r=t[e];r&&(r.classList.add("flickering"),window.setTimeout(()=>{try{r.classList.remove("flickering")}catch(t){}},140+240*Math.random()))}},360+720*Math.random()),()=>{l&&(clearInterval(l),l=null);try{window.clearTimeout(n)}catch(t){}}},[o]),(0,i.useEffect)(()=>{var t,e;if(null===(t=(e=window).matchMedia)||void 0===t?void 0:t.call(e,"(prefers-reduced-motion: reduce)").matches)return;let r=null,n=M.current;if(n){if(!i()){let t=Date.now(),e=window.setInterval(()=>{(i()||Date.now()-t>2e3)&&window.clearInterval(e)},50)}return()=>{if(r)try{r()}catch(t){}}}function i(){return"function"==typeof window.attachGlitchHeading&&(r=window.attachGlitchHeading(n,E,{intervalMs:260,chance:.08,restoreMin:160,restoreJitter:140}),!0)}},[]),(0,n.jsx)("main",{className:"home",role:"main",children:(0,n.jsxs)("section",{className:"hero-intro","aria-label":"SYNTHOMA Intro",children:[(0,n.jsx)("div",{id:"resizing-text",className:"intro-title ".concat(t?"visible":"").trim(),children:(0,n.jsxs)("h1",{id:"glitch-synthoma",className:"glitch-master",ref:M,"aria-label":E,children:[(0,n.jsx)("span",{className:"glitch-fake1",children:E}),(0,n.jsx)("span",{className:"glitch-fake2",children:E}),(0,n.jsx)("span",{className:"glitch-real","aria-hidden":"true",children:E.split("").map((t,e)=>(0,n.jsx)("span",{className:"glitch-char",children:t},e))}),(0,n.jsx)("span",{className:"sr-only",children:E})]})}),(0,n.jsx)("div",{className:"manifest-wrapper ".concat(o?"has-cta":"").trim(),children:(0,n.jsxs)("p",{className:"manifest typewriter shinning",id:"manifest-container","aria-live":"polite","aria-atomic":!0,children:[(0,n.jsx)("span",{className:"noising-text","aria-hidden":"true"}),(0,n.jsx)("span",{className:"sr-only",children:A})]})}),o&&!u?(0,n.jsx)("div",{className:"hero-cta",children:(0,n.jsxs)("button",{className:"glitch-button appear ".concat(s?"visible":"").trim(),onClick:D,"aria-label":L,ref:C,disabled:v||k.current,children:[(0,n.jsx)("span",{className:"glitch-fake1"}),(0,n.jsx)("span",{className:"glitch-fake2"}),(0,n.jsx)("span",{className:"glitch-real","aria-hidden":"true",children:(0,n.jsx)("span",{className:"noising-text"})}),(0,n.jsx)("span",{className:"sr-only",children:L})]})}):null,u?(0,n.jsx)("div",{className:"reader-container","aria-live":"polite",children:(0,n.jsx)("div",{className:"SYNTHOMAREADER terminal",role:"region","aria-label":"Termin\xe1l SYNTHOMA",children:(0,n.jsxs)("div",{id:"reader-content",children:[(0,n.jsx)("div",{id:"reader-body",className:"text",children:(0,n.jsx)("span",{className:"noising-text","aria-hidden":"true"})}),(0,n.jsxs)("p",{id:"reader-dialog",className:"dialog",children:[(0,n.jsx)("span",{className:"noising-text"}),(0,n.jsxs)("span",{className:"sr-only",children:["„V\xedtej v SYNTHOMĚ, ",(0,n.jsx)("span",{className:"glitching",children:"@&SĐYŁ"})," !!! Tady jm\xe9no nikoho nezaj\xedm\xe1, ale chyby? Ty jsou v paměti věčně.“"]})]}),(0,n.jsxs)("p",{id:"reader-title",className:"text",children:[(0,n.jsx)("span",{className:"noising-text","aria-hidden":"true"}),(0,n.jsx)("span",{className:"rich-hidden","aria-hidden":"true",children:"Chceš si přeč\xedst p\xe1r informac\xed nebo se rovnou d\xe1t na čten\xed?"})]}),(0,n.jsxs)("div",{className:"reader-controls appear ".concat(p?"visible":"").trim(),children:[(0,n.jsx)("button",{type:"button",className:"glitch-button small",onClick:()=>{f().catch(t=>console.error("INFO failed",t))},"aria-label":"Zobrazit INFO",children:"INFO"}),(0,n.jsx)("button",{type:"button",className:"glitch-button small",onClick:()=>{x().catch(t=>console.error("Books failed",t))},"aria-label":"Zač\xedt č\xedst",children:"KNIHA"})]}),(0,n.jsx)("div",{id:"reader-extra","aria-live":"polite",children:(0,n.jsx)("span",{className:"noising-text","aria-hidden":"true"})})]})})}):null]})})}},4646:function(t,e,r){"use strict";function n(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"".concat("/SynThoma","/audio/SynthBachmoff.mp3"),e=window;if(!e.__synthomaAudio){let r=new Audio(t);r.loop=!1,r.volume=1,e.__synthomaAudio=r}return e.__synthomaAudio}r.d(e,{G:function(){return n}})},3069:function(t,e,r){"use strict";var n,i;t.exports=(null==(n=r.g.process)?void 0:n.env)&&"object"==typeof(null==(i=r.g.process)?void 0:i.env)?r.g.process:r(7030)},7030:function(t){!function(){var e={229:function(t){var e,r,n,i=t.exports={};function a(){throw Error("setTimeout has not been defined")}function l(){throw Error("clearTimeout has not been defined")}function o(t){if(e===setTimeout)return setTimeout(t,0);if((e===a||!e)&&setTimeout)return e=setTimeout,setTimeout(t,0);try{return e(t,0)}catch(r){try{return e.call(null,t,0)}catch(r){return e.call(this,t,0)}}}!function(){try{e="function"==typeof setTimeout?setTimeout:a}catch(t){e=a}try{r="function"==typeof clearTimeout?clearTimeout:l}catch(t){r=l}}();var c=[],s=!1,d=-1;function u(){s&&n&&(s=!1,n.length?c=n.concat(c):d=-1,c.length&&h())}function h(){if(!s){var t=o(u);s=!0;for(var e=c.length;e;){for(n=c,c=[];++d<e;)n&&n[d].run();d=-1,e=c.length}n=null,s=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===l||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(t)}}function m(t,e){this.fun=t,this.array=e}function y(){}i.nextTick=function(t){var e=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];c.push(new m(t,e)),1!==c.length||s||o(h)},m.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=y,i.addListener=y,i.once=y,i.off=y,i.removeListener=y,i.removeAllListeners=y,i.emit=y,i.prependListener=y,i.prependOnceListener=y,i.listeners=function(t){return[]},i.binding=function(t){throw Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw Error("process.chdir is not supported")},i.umask=function(){return 0}}},r={};function n(t){var i=r[t];if(void 0!==i)return i.exports;var a=r[t]={exports:{}},l=!0;try{e[t](a,a.exports,n),l=!1}finally{l&&delete r[t]}return a.exports}n.ab="//";var i=n(229);t.exports=i}()}},function(t){t.O(0,[869,753,744],function(){return t(t.s=5934)}),_N_E=t.O()}]);